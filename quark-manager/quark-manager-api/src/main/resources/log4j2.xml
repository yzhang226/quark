<?xml version="1.0" encoding="UTF-8"?>
<configuration status="OFF" monitorInterval="1800" packages="org.apache.logging.log4j.core,com.getsentry.raven.log4j2">
    <properties>
        <property name="log.dir">/data/logs/quark-manager</property>
        <property name="pattern">[%level] [%date{ISO8601}] [%logger:%line] [%thread] [] [%X{requestId}] [%X{serverIp}] %msg%n</property>
    </properties>
    <appenders>

        <Console name="Console" target="SYSTEM_OUT" follow="true">
            <PatternLayout pattern="${pattern}"/>
        </Console>

        <RollingRandomAccessFile name="InfoFile" fileName="${log.dir}/info.log"
                                 filePattern="${log.dir}/info_%d{yyyy-MM-dd}-%i.log">
            <PatternLayout pattern="${pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
                <SizeBasedTriggeringPolicy size="100MB"/>
            </Policies>
            <DefaultRolloverStrategy max="2">
                <Delete basePath="${log.dir}" maxDepth="1">
                    <IfFileName glob="info*log"/>
                    <IfLastModified age="P30D"/>
                </Delete>
            </DefaultRolloverStrategy>
            <Filters>
                <ThresholdFilter level="error" onMatch="DENY" onMismatch="NEUTRAL"/>
                <ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/>
            </Filters>
        </RollingRandomAccessFile>

        <RollingRandomAccessFile name="ErrorFile" fileName="${log.dir}/error.log"
                                 filePattern="${log.dir}/error_%d{yyyy-MM-dd}-%i.log">
            <PatternLayout pattern="${pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
                <SizeBasedTriggeringPolicy size="100MB"/>
            </Policies>
            <DefaultRolloverStrategy max="1">
                <Delete basePath="${log.dir}" maxDepth="1">
                    <IfFileName glob="error*log"/>
                    <IfLastModified age="P30D"/>
                </Delete>
            </DefaultRolloverStrategy>
            <Filters>
                <ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="DENY"/>
            </Filters>
        </RollingRandomAccessFile>

        <RollingRandomAccessFile name="DebugFile" fileName="${log.dir}/debug.log"
                                 filePattern="${log.dir}/debug_%d{yyyy-MM-dd}-%i.log">
            <PatternLayout pattern="${pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
                <SizeBasedTriggeringPolicy size="100MB"/>
            </Policies>
            <DefaultRolloverStrategy max="1">
                <Delete basePath="${log.dir}" maxDepth="1">
                    <IfFileName glob="debug*log"/>
                    <IfLastModified age="P30D"/>
                </Delete>
            </DefaultRolloverStrategy>
            <Filters>
                <ThresholdFilter level="error" onMatch="DENY" onMismatch="NEUTRAL"/>
                <ThresholdFilter level="info" onMatch="DENY" onMismatch="NEUTRAL"/>
                <ThresholdFilter level="debug" onMatch="ACCEPT" onMismatch="DENY"/>
            </Filters>
        </RollingRandomAccessFile>

    </appenders>

    <loggers>

        <Root level="INFO">
            <!-- disable Console in product env -->
            <appender-ref ref="Console"/>
            <appender-ref ref="ErrorFile"/>
            <appender-ref ref="InfoFile"/>
            <appender-ref ref="DebugFile"/>
        </Root>
    </loggers>


</configuration>
